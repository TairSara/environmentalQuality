{% load static %}
<!DOCTYPE html>
<html lang="he">
<head>
    <meta charset="UTF-8">
    <title>צעד למיחזור</title>
    <link rel="stylesheet" type="text/css" href="{% static 'css/styles.css' %}">
</head>
<body>
    <h1>חידון</h1>

    {% if user.user_type == False and not user.is_superuser %}
    <a href="{% url 'logout' %}">להתנתקות ויציאה</a> <br>
    <div id="container">
        <h1>חידון</h1>
        <div id="questions"></div>
        <div id="results"></div>
    </div>
    <script src="{% static 'js/scripts.js' %}"></script>
    {% else %}
    <h1>הוספת שאלה חדשה</h1>
    <form id="questionForm">
        <label for="questionText">השאלה:</label>
        <input type="text" id="questionText" name="questionText" required><br><br>
        <label for="option1">אופציה 1:</label>
        <input type="text" id="option1" name="option1" required><br><br>
        <label for="option2">אופציה 2:</label>
        <input type="text" id="option2" name="option2" required><br><br>
        <label for="option3">אופציה 3:</label>
        <input type="text" id="option3" name="option3" required><br><br>
        <label for="option4">אופציה 4:</label>
        <input type="text" id="option4" name="option4" required><br><br>
        <label for="correctAnswer">תשובה נכונה:</label>
        <input type="text" id="correctAnswer" name="correctAnswer" required><br><br>
        <button type="button" onclick="addQuestion()">הוסף שאלה</button>
    </form>

   
    <h1>השאלות שנוספו</h1>
    <table id="questionTable">
        <tr>
            <th>השאלה</th>
            <th>אפשרויות</th>
        </tr>
    </table>


    <script>
        let questions = JSON.parse(localStorage.getItem('questions')) || []; // Retrieve questions from Local Storage
        let index = questions.length; // Initialize index variable

        // Load questions from Local Storage on page load
        window.onload = function() {
            updateQuestionTable();
        }

        function addQuestion() {
            let questionText = document.getElementById('questionText').value;
            let option1 = document.getElementById('option1').value;
            let option2 = document.getElementById('option2').value;
            let option3 = document.getElementById('option3').value;
            let option4 = document.getElementById('option4').value;
            let correctAnswer = document.getElementById('correctAnswer').value;

            let question = {
                index: index + 1,
                question: questionText,
                options: [option1, option2, option3, option4],
                correctAnswer: correctAnswer
            };

            questions.push(question);
            localStorage.setItem('questions', JSON.stringify(questions)); // Save questions to Local Storage
            index += 1; // Increment index with each new question
            document.getElementById('questionForm').reset();
            alert("השאלה נוספה בהצלחה");

            // Clear fields and show add question option
            clearFields();
            showAddQuestionOption();

            // Update question table
            updateQuestionTable();
        }

        function clearFields() {
            document.getElementById('questionText').value = '';
            document.getElementById('option1').value = '';
            document.getElementById('option2').value = '';
            document.getElementById('option3').value = '';
            document.getElementById('option4').value = '';
            document.getElementById('correctAnswer').value = '';
        }

        function showAddQuestionOption() {
            document.getElementById('questionForm').style.display = 'block';
        }

        function updateQuestionTable() {
            let table = document.getElementById('questionTable');
            table.innerHTML = ''; // Clear existing table content

            // Iterate through questions array and populate the table
            for (let i = 0; i < questions.length; i++) {
                let row = table.insertRow();
                let cell1 = row.insertCell(0);
                let cell2 = row.insertCell(1);
                let cell3 = row.insertCell(2);
                cell1.innerHTML = questions[i].index;
                cell2.innerHTML = questions[i].question;
                cell3.innerHTML = '<button onclick="editQuestion(' + i + ')">עריכה</button>' +
                                  '<button onclick="deleteQuestion(' + i + ')">מחיקה</button>';
            }
        }

        function editQuestion(index) {
            let question = questions[index];
            // Populate form fields with question data for editing
            document.getElementById('questionText').value = question.question;
            document.getElementById('option1').value = question.options[0];
            document.getElementById('option2').value = question.options[1];
            document.getElementById('option3').value = question.options[2];
            document.getElementById('option4').value = question.options[3];
            document.getElementById('correctAnswer').value = question.correctAnswer;

            // Remove the edited question from the questions array
            questions.splice(index, 1);

            // Update question table after editing
            updateQuestionTable();
        }

        function deleteQuestion(index) {
            // Remove the deleted question from the questions array
            questions.splice(index, 1);

            // Update question table after deletion
            updateQuestionTable();
        }
    </script>
    {% endif %}
</body>
</html>
